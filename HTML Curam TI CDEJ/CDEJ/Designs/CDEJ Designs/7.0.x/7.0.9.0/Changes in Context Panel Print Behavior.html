<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Changes in Context Panel Print Behavior</title>
<link rel="stylesheet" type="text/css" id="defaultStylesheet" href="../../../../../wiki.css" />
<script type="text/javascript" src="../../../../../wiki.js" ></script>
<script type="text/javascript" src="../../../../../navigation.js" ></script>
<script type="text/javascript">
    wikiName="Curam TI CDEJ";
    wikiId="urn:lsid:ibm.com:td:efdf6112-d0d3-4d1d-811e-8ccefe245ee8";
    pageName="Changes in Context Panel Print Behavior";
    pageId="urn:lsid:ibm.com:td:b4891da4-eaf1-4f31-9b07-8060f894bc76";
    toRoot="../../../../../";
</script>
</head>
<body onload="wikiLoad()">
<div class="main-wrapper">
  <div class="wiki-title-container" id="wiki-title-container">
    <div class="wiki-title-pane">
      <div class="wiki-title-text">Curam TI CDEJ</div>
    </div>
  </div>
  <div class="title-container" id="title-container">
    <div class="title-pane"> 
      <div class="title-text">Changes in Context Panel Print Behavior</div>
    </div> 
  </div>
  <div class="main-menu-container" id="main-menu-container">
    <ul class="main-menu" id="main-menu">
    </ul>
  </div>
  <div class="content-container" id="content-container">
    <div class="content-pane"> 
<div><h1 dir="ltr"><span style="font-size:20px;"><strong sandbox="allow-forms allow-same-origin allow-scripts allow-popups">Design Page for </strong></span><span class="floatingTable" dojoattachpoint="floatingTableNode"><span class="titleTextArea" dojoattachpoint="titleTextAreaNode"><span class="TitleText" dojoattachpoint="_titleTextNode" tabindex="0">239509</span></span></span><span style="font-size:20px;"><strong sandbox="allow-forms allow-same-origin allow-scripts allow-popups"> - Changes in print behavior</strong></span></h1>

<p dir="ltr"><span style="font-size:20px;"><strong sandbox="allow-forms allow-same-origin allow-scripts allow-popups">Note:&nbsp;</strong></span><strong sandbox="allow-forms allow-same-origin allow-scripts allow-popups"><span style="font-size:14px;">A different fix was chosen in the end for defect 239509. This solution is still an option going forward to overcome the issue of there being 2 print dialogs required to print a page.</span></strong></p>

<h2 dir="ltr" id="ii4">Background</h2>

<p dir="ltr">Curam provides an OOTB property called disable.context.panel.print which allows the user to disable printing of the Context Panel when printing a Curam page. When disable.context.panel.print is set to true only the main content area will be printed. When disable.context.panel.print is set to false the Context Panel and the main content area will both be printed.</p>

<p dir="ltr">Previously, after clicking the page level print icon on a page when disable.context.panel.print is set to false a print dialog would open allowing the user to print just the Context Panel. When the user either closes or prints the Context Panel using this first print dialog a second print dialog would open allowing the user to print the main content area. Each print dialog was opened through javascript by calling the window.print() on the iframe containing the Context Panel, then on the iframe containing the main content area.</p>

<p dir="ltr">This approach used to work fine because browsers would pause on window.print() after calling it on the iframe containing the Context Panel until the user either printed or closed the print dialog pop up for the Context Panel. Then we would call window.print() on the iframe containing the main content area and the second print dialog pop up would appear. However, newer versions of IE and Edge do not pause anymore when the window.print() function is called. This means after calling window.print() on the iframe containing the Context Panel the code will run straight through and call window.print() on the iframe containing the main content area, now, the print dialog for printing the Context Panel will be still open when the code runs through and calls window.print() on the main content area iframe so a second print dialog will never be opened and the user can not print the main content area.</p>

<p dir="ltr">&nbsp;</p>

<h2 dir="ltr" id="ii5">Requirements</h2>

<ul dir="ltr">
	<li sandbox="allow-forms allow-same-origin allow-scripts allow-popups">Clicking on the page level print icon with disable.context.panel.print set to false shall print both the Context panel and the main content area.</li>
	<li sandbox="allow-forms allow-same-origin allow-scripts allow-popups">Clicking on the page level print icon with disable.context.panel.print set to true shall print the main content area but not the context panel.</li>
</ul>

<p dir="ltr">These requirements will have to be implemented by only making one call to the window.print() function.</p>

<p dir="ltr">&nbsp;</p>

<h3 dir="ltr" id="ii6">Requirement Decisions</h3>

<ul dir="ltr">
	<li>When the property disable.context.panel.print is set to false and a user clicks on the page level print icon.
	<ul>
		<li>A temporary hidden iframe shall be created off screen.
		<ul>
			<li>The temporary hidden iframe shall be populated with the contents of the Context Panel and the main content area.</li>
			<li>window.print()&nbsp; shall be called on the temporary hidden iframe and in turn open up a print dialog allowing the user to print the Context Panel and the main content area on the same page (or multiple pages if they extend beyond one page). The Context Panel content shall be printed above of the main content area just like it appears on the page.</li>
		</ul>
		</li>
	</ul>
	</li>
	<li>When the property disable.context.panel.print is set to true and a user clicks on the page level print icon.
	<ul>
		<li>window.print() shall be called on the iframe containing the main page content as is now.</li>
	</ul>
	</li>
</ul>

<p dir="ltr">&nbsp;</p>

<h2 dir="ltr" id="ii8">Design</h2>

<p dir="ltr">&nbsp;</p>

<ul dir="ltr">
	<li>Update the javascript function printpage() in /client-inf/jscript/src/internal/curam/util.js. These changes shall apply to each browser we support.</li>
	<li>It shall create a temporary iframe which will be hidden off screen by the css "<em>border: none; position: absolute; left: -5000px;</em>"</li>
	<li>If disable.context.panel.print is set to false this function shall take the content of the Context Panel (i.e. Everything with the element with the class <em>detailsPanelFrame</em>) and add it to a temporary iframe. It shall then take the contents of the main content area (i.e. Everything within the element with the class contentPanelFrame) and add them to the temporary iframe.</li>
	<li>To ensure css has been applied to elements within the temporary iframe before calling window.print() on the iframe:
	<ul>
		<li>An element with the class temporaryIFramePrintOnlyElement is added to the temporary iframe. The class temporaryIFramePrintOnlyElement will look like:</li>
		<li>.temporaryIFramePrintOnlyElement {<br />
		&nbsp;&nbsp; display: none;<br />
		}</li>
		<li>The value of the attribute display on this temporary element will be checked every 500 milliseconds. Once the display value of this temporary element is set to none it means css has been applied so window.print() can be called on the temporary iframe.</li>
	</ul>
	</li>
</ul>

<p dir="ltr">&nbsp;</p>

<h2 dir="ltr" id="ii28">Use Cases</h2>

<p dir="ltr">&nbsp;</p>

<p dir="ltr">&nbsp;</p>

<table border="1" dir="ltr" height="329" width="539">
	<tbody sandbox="allow-forms allow-same-origin allow-scripts allow-popups">
		<tr sandbox="allow-forms allow-same-origin allow-scripts allow-popups">
			<td style="width: 188px;">Use Case ID</td>
			<td style="width: 336px;">1.1</td>
		</tr>
		<tr sandbox="allow-forms allow-same-origin allow-scripts allow-popups">
			<td style="width: 188px;">Name</td>
			<td style="width: 336px;">Printing Context Panel and main content area</td>
		</tr>
		<tr sandbox="allow-forms allow-same-origin allow-scripts allow-popups">
			<td style="width: 188px;">Actor</td>
			<td style="width: 336px;">Caseworker</td>
		</tr>
		<tr sandbox="allow-forms allow-same-origin allow-scripts allow-popups">
			<td style="width: 188px;">Description</td>
			<td style="width: 336px;">
			<p sandbox="allow-forms allow-same-origin allow-scripts allow-popups">With context panel printing enabled. Print a Curam page containing a Context Panel using the page level print icon.</p>
			</td>
		</tr>
		<tr sandbox="allow-forms allow-same-origin allow-scripts allow-popups">
			<td style="width: 188px;">Preconditions</td>
			<td style="width: 336px;">
			<p sandbox="allow-forms allow-same-origin allow-scripts allow-popups">Set the property disable.context.panel.print to false.</p>
			</td>
		</tr>
		<tr sandbox="allow-forms allow-same-origin allow-scripts allow-popups">
			<td style="width: 188px;">Flow</td>
			<td style="width: 336px;">
			<p>** To be tested on all supported browsers**</p>

			<p>Login as caseworker.</p>

			<p>Search for a person and open up the person page.</p>

			<p>Click on the page level print icon.</p>
			</td>
		</tr>
		<tr sandbox="allow-forms allow-same-origin allow-scripts allow-popups">
			<td style="width: 188px;">Expected</td>
			<td style="width: 336px;">A single print dialog should open giving you the option to print a single page which displays the context panel and the main content area.</td>
		</tr>
	</tbody>
</table>

<p dir="ltr">&nbsp;</p>

<p dir="ltr">&nbsp;</p>

<p dir="ltr">&nbsp;</p>

<table border="1" dir="ltr" height="329" width="539">
	<tbody sandbox="allow-forms allow-same-origin allow-scripts allow-popups">
		<tr sandbox="allow-forms allow-same-origin allow-scripts allow-popups">
			<td style="width: 188px;">Use Case ID</td>
			<td style="width: 336px;">1.2</td>
		</tr>
		<tr sandbox="allow-forms allow-same-origin allow-scripts allow-popups">
			<td style="width: 188px;">Name</td>
			<td style="width: 336px;">Printing main content area only</td>
		</tr>
		<tr sandbox="allow-forms allow-same-origin allow-scripts allow-popups">
			<td style="width: 188px;">Actor</td>
			<td style="width: 336px;">Caseworker</td>
		</tr>
		<tr sandbox="allow-forms allow-same-origin allow-scripts allow-popups">
			<td style="width: 188px;">Description</td>
			<td style="width: 336px;">
			<p sandbox="allow-forms allow-same-origin allow-scripts allow-popups">With context panel printing disabled. Print a Curam page containing a Context Panel using the page level print icon.</p>
			</td>
		</tr>
		<tr sandbox="allow-forms allow-same-origin allow-scripts allow-popups">
			<td style="width: 188px;">Preconditions</td>
			<td style="width: 336px;">
			<p sandbox="allow-forms allow-same-origin allow-scripts allow-popups">Set the property disable.context.panel.print to true.</p>
			</td>
		</tr>
		<tr sandbox="allow-forms allow-same-origin allow-scripts allow-popups">
			<td style="width: 188px;">Flow</td>
			<td style="width: 336px;">
			<p>** To be tested on all supported browsers**</p>

			<p>Login as caseworker.</p>

			<p>Search for a person and open up the person page.</p>

			<p>Click on the page level print icon.</p>
			</td>
		</tr>
		<tr sandbox="allow-forms allow-same-origin allow-scripts allow-popups">
			<td style="width: 188px;">Expected</td>
			<td style="width: 336px;">A single print dialog should open giving you the option to print only the main content area. Not the Context Panel.</td>
		</tr>
	</tbody>
</table>

<p dir="ltr">&nbsp;</p>

<table border="1" dir="ltr" height="329" width="539">
	<tbody sandbox="allow-forms allow-same-origin allow-scripts allow-popups">
		<tr sandbox="allow-forms allow-same-origin allow-scripts allow-popups">
			<td style="width: 188px;">Use Case ID</td>
			<td style="width: 336px;">1.3</td>
		</tr>
		<tr sandbox="allow-forms allow-same-origin allow-scripts allow-popups">
			<td style="width: 188px;">Name</td>
			<td style="width: 336px;">Printing page with no Context Panel</td>
		</tr>
		<tr sandbox="allow-forms allow-same-origin allow-scripts allow-popups">
			<td style="width: 188px;">Actor</td>
			<td style="width: 336px;">Caseworker</td>
		</tr>
		<tr sandbox="allow-forms allow-same-origin allow-scripts allow-popups">
			<td style="width: 188px;">Description</td>
			<td style="width: 336px;">
			<p sandbox="allow-forms allow-same-origin allow-scripts allow-popups">Print a Curam page containing a Context Panel with no Context Panel.</p>
			</td>
		</tr>
		<tr sandbox="allow-forms allow-same-origin allow-scripts allow-popups">
			<td style="width: 188px;">Preconditions</td>
			<td style="width: 336px;">
			<p sandbox="allow-forms allow-same-origin allow-scripts allow-popups">&nbsp;</p>
			</td>
		</tr>
		<tr sandbox="allow-forms allow-same-origin allow-scripts allow-popups">
			<td style="width: 188px;">Flow</td>
			<td style="width: 336px;">
			<p>** To be tested on all supported browsers**</p>

			<p>Login as caseworker.</p>

			<p>Open up the person search page.</p>

			<p>Click on the page level print icon.</p>
			</td>
		</tr>
		<tr sandbox="allow-forms allow-same-origin allow-scripts allow-popups">
			<td style="width: 188px;">Expected</td>
			<td style="width: 336px;">A single print dialog should open giving you the option to print the person search page.</td>
		</tr>
	</tbody>
</table>

<h2 dir="ltr" id="ii18">Testing</h2>

<ul dir="ltr">
	<li style="margin-left: 40px;">Unit Tests
	<ul>
		<li style="margin-left: 40px;">Javascript unit tests were added to /client-inf/jscript/tests/cdej/util/UtilTestCase.js
		<ul>
			<li style="margin-left: 40px;">test _temporaryPrintableIFrameWithContextPanel(Enabled)AndContentPanel</li>
			<li style="margin-left: 40px;">test _temporaryPrintableIFrameWithContextPanel(Disabled)AndContentPanel</li>
			<li style="margin-left: 40px;">test _temporaryPrintableIFrameWithContextPanelEnabledButNotAvailableAndContentPanel</li>
		</ul>
		</li>
	</ul>
	</li>
	<li style="margin-left: 40px;">FVT Required
	<ul>
		<li style="margin-left: 40px;">The full printing CPT should be ran through.</li>
	</ul>
	</li>
</ul>

<h2 dir="ltr" id="ii19">How To Use Feature</h2>

<p dir="ltr">Open up any Curam page (not in a modal) and click on the page level print icon.</p>

<p dir="ltr">&nbsp;</p></div>    </div>
  </div>
</div>

</body>
</html>